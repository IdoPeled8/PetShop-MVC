@model PetShopModels.Animal
@{
    ViewBag.Title = "AnimalInformation";
}


@section Header{
    Animal information
}

<table class="table">
    <thead class="thead-dark">
        <tr>
            <th style="width: 20%">Photo</th>
            <th style="width: 10%">Name</th>
            <th style="width: 5%">Age</th>
            <th style="width: 10%">Category</th>
            <th style="width: 25%">Description</th>
            <th style="width: 30%">Comments</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>   <img src="~/Pics/@Model.ImageName" class="img-fluid" alt="Animal Image" width="200" height="200">
            <td><strong>@Model.Name</strong></td>
            <td><strong>@Model.Age</strong></td>
            <td><strong>@Model.Category!.Name</strong></td>
            <td><strong>@Model.Description</strong></td>

            <td id="commentsContainer">
                    @await Html.PartialAsync("_CommentsPartial",Model)
            </td>
        </tr>
    </tbody>
</table>

<div id="newCommentFormContainer">
    @if (User.Identity!.IsAuthenticated)
    {
        <form class="col-md-5" id="newCommentForm" data-animal-id="@Model.AnimalId" method="post" action="@Url.Action("AddComment", "Animal")">
            <input type="hidden" name="animalId" value="@Model.AnimalId" />
            <div>
                <textarea id="commentTextID" name="commentText" class="form-control" rows="3" placeholder="Add new comment" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Comment</button>
        </form>
    }
    else
    {
        <a>To add comment please Login or Signup</a>
        <a asp-action="Login" asp-controller="Account" class="btn btn-primary">Login</a>
    }
</div>


    <script>
        $(document).ready(function () {
            $("#newCommentForm").submit(function (e) {
                e.preventDefault(); 

              
                var formData = $(this).serialize();

                $.ajax({
                    url: $(this).attr("action"),
                    type: "POST",
                    data: formData,

                    success: function (response) {
                        $("#commentsContainer").html(response);

                        $("#newCommentForm textarea").val("");
                    },
                    error: function (error) {
                    console.log("Error occurred when trying to add comment")
                    }
                });
            });
        });


</script>
